<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fireworks Animation</title>
    <style>
        body {
            margin: 0;
            padding: 0;
            overflow: hidden;
        }

        canvas {
            display: block;
        }
    </style>
</head>

<body>
    <canvas id="canvas"></canvas>
    <script>
        // 获取 canvas 元素
        var canvas = document.getElementById("canvas");
        // 设置 canvas 的宽度为窗口的宽度
        canvas.width = window.innerWidth;
        // 设置 canvas 的高度为窗口的高度
        canvas.height = window.innerHeight;
        // 获取 2D 绘图上下文
        var ctx = canvas.getContext("2d");
        // 存储烟花对象的数组
        var fireworksArray = [];
        // 存储粒子对象的数组
        var particlesArray = [];

        // 定义一个名为 Particle 的类，表示粒子
        class Particle {
            constructor(x, y, color) {
                this.x = x;
                this.y = y;
                this.c = color;
                // 随机生成粒子在 x 方向的速度
                this.vx = (0.5 - Math.random()) * 100;
                // 随机生成粒子在 y 方向的速度
                this.vy = (0.5 - Math.random()) * 100;
                this.c = color;
                // 随机生成粒子的寿命
                this.age = Math.random() * 100 | 0;
            }
            // 更新粒子的位置和状态
            update() {
                this.x += this.vx / 20;
                this.y += this.vy / 20;
                this.vy++;
                this.age--;
            }
            // 绘制粒子
            draw() {
                ctx.globalAlpha = 1;
                ctx.beginPath();
                ctx.fillStyle = this.c;
                ctx.arc(this.x, this.y, 1, 0, Math.PI * 2);
                ctx.fill();
            }
        }

        // 定义一个名为 Firework 的类，表示烟花
        class Firework {
            // 构造函数，用于初始化烟花对象的属性
            constructor() {
                // 将烟花的初始 y 坐标设置为画布的高度，即烟花从画布底部开始
                this.y = canvas.height;
                // 随机生成烟花的初始 x 坐标，范围是 0 到画布的宽度
                this.x = Math.random() * canvas.width | 0;
                // 计算烟花的初始速度，速度为负值表示烟花向上运动
                this.vel = -(Math.random() * Math.sqrt(canvas.height) / 3 + Math.sqrt(4 * canvas.height) / 2) / 5;
                // 随机生成烟花的颜色，使用 HSL 颜色模式
                this.c = "hsl(" + (Math.random() * 360 | 0) + ",100%,60%)";
            }
            // 更新烟花的位置和状态
            update() {
                // 根据速度更新烟花的 y 坐标
                this.y += this.vel;
                // 烟花的速度逐渐增加，模拟重力效果
                this.vel += 0.04;
                // 当烟花的速度大于等于 0 时，表示烟花到达最高点，开始爆炸
                if (this.vel >= 0) {
                    // 生成 200 个粒子，模拟烟花爆炸的效果
                    for (var i = 0; i < 200; i++) {
                        particlesArray.push(new Particle(this.x, this.y, this.c));
                    }
                    // 重置烟花的 y 坐标为画布底部
                    this.y = canvas.height;
                    // 重新随机生成烟花的 x 坐标
                    this.x = Math.random() * canvas.width | 0;
                    // 重新计算烟花的速度
                    this.vel = -(Math.random() * Math.sqrt(canvas.height) / 3 + Math.sqrt(4 * canvas.height) / 2) / 5;
                    // 重新随机生成烟花的颜色
                    this.c = "hsl(" + (Math.random() * 360 | 0) + ",100%,60%)";
                }
            }
            // 绘制烟花
            draw() {
                // 设置全局透明度为 1
                ctx.globalAlpha = 1;
                // 开始绘制路径
                ctx.beginPath();
                // 设置填充颜色为烟花的颜色
                ctx.fillStyle = this.c;
                // 绘制一个圆形，表示烟花
                ctx.arc(this.x, this.y, 3, 0, Math.PI * 2);
                // 填充圆形
                ctx.fill();
            }
        }

        // 初始化烟花的函数
        function init_fireworks() {
            // 循环的次数根据画布宽度除以200的结果向下取整来确定
            // 用于创建一定数量的烟花对象并添加到烟花数组中
            for (var i = 0; i < (canvas.width / 200 | 0); i++) {
                // 创建一个新的烟花对象并添加到烟花数组 fireworksArray 中
                fireworksArray.push(new Firework());
            }
        }
        // 调用初始化烟花的函数，开始创建烟花对象
        init_fireworks();

        // 绘制动画的函数
        function draw() {
            // 设置全局透明度为 0.1，用于实现渐变的背景效果
            ctx.globalAlpha = 0.1;
            // 设置填充颜色为黑色
            ctx.fillStyle = "black";
            // 绘制一个黑色的矩形，覆盖整个画布，用于清除之前的绘制内容
            ctx.fillRect(0, 0, canvas.width, canvas.height);

            // 遍历烟花数组，更新每个烟花的位置并绘制
            for (var i = 0; i < fireworksArray.length; i++) {
                // 更新当前烟花的位置和状态
                fireworksArray[i].update();
                // 绘制当前烟花
                fireworksArray[i].draw();
            }

            // 遍历粒子数组，更新每个粒子的位置并绘制
            for (var i = 0; i < particlesArray.length; i++) {
                // 更新当前粒子的位置和状态
                particlesArray[i].update();
                // 绘制当前粒子
                particlesArray[i].draw();
                // 如果粒子的寿命小于 0，说明粒子已经消失，从粒子数组中移除该粒子
                if (particlesArray[i].age < 0) {
                    particlesArray.splice(i, 1);
                }
            }
            // 请求浏览器在下一次重绘之前调用 draw 函数，实现动画效果
            requestAnimationFrame(draw);
        }

        // 调用绘制函数，开始动画循环
        draw();
    </script>
</body>

</html>